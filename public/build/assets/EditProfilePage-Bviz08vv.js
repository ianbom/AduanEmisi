import{r as g,j as e,S as F,J as H}from"./app-CEf6-TVv.js";import{B as f,C as N,b as v,d as y,a as b,I as q}from"./index-T59oawn7.js";import{L as c}from"./label-r7WXdrwQ.js";import{S as _,a as S,b as k,c as C,d as P}from"./select-D_0_1Ftm.js";import{T as O,U as W,F as X}from"./textarea-CYm7tM4B.js";import{A as Q}from"./arrow-left-msm6bzUj.js";import{I as Y,X as Z,C as ee}from"./CitizenLayout-BJCqtu_4.js";import{M as se}from"./map-pin-CvMsSeln.js";import{C as ae}from"./camera-DnnFKy1W.js";import"./index-BYYFiwgR.js";const ie=({provinces:o,onBack:m,auth:t})=>{var L,M,I,K,U,T,B,D,E;const[i,w]=g.useState(!1),[r,x]=g.useState({name:((L=t.user)==null?void 0:L.name)||"",phone:((M=t.user)==null?void 0:M.phone)||"",address:((I=t.user)==null?void 0:I.address)||"",province_id:((U=(K=t.user)==null?void 0:K.province_id)==null?void 0:U.toString())||"",city_id:((B=(T=t.user)==null?void 0:T.city_id)==null?void 0:B.toString())||"",district_id:((E=(D=t.user)==null?void 0:D.district_id)==null?void 0:E.toString())||""}),[p,z]=g.useState([]),h=o.find(s=>s.id.toString()===r.province_id),u=(h==null?void 0:h.cities)??[],j=u.find(s=>s.id.toString()===r.city_id),A=(j==null?void 0:j.districts)??[],d=(s,a)=>{x(s==="province_id"?l=>({...l,province_id:a,city_id:"",district_id:""}):s==="city_id"?l=>({...l,city_id:a,district_id:""}):l=>({...l,[s]:a}))},V=s=>{if(s){const a=Array.from(s).filter(l=>l.size>10485760?(alert(`File ${l.name} terlalu besar. Maksimal 10MB.`),!1):!0);z(a)}},R=s=>{z(a=>a.filter((l,n)=>n!==s))},$=()=>{const s=[{field:"name",name:"Nama Lengkap"},{field:"phone",name:"Nomor Telepon"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:a,name:l}of s)if(!r[a])return alert(`${l} wajib diisi.`),!1;return!0},G=async s=>{var l;if(s.preventDefault(),!$())return;const a=new FormData;a.append("name",r.name),a.append("phone",r.phone),a.append("address",r.address),a.append("province_id",r.province_id),a.append("city_id",r.city_id),a.append("district_id",r.district_id),p.length>0&&a.append("profile_url",p[0]),console.log("Uploaded file:",p[0]),console.log("FormData entries:");for(const n of a.entries())console.log(`${n[0]}:`,n[1]);w(!0);try{await F.post("/update-profile",a,{forceFormData:!0,onSuccess:()=>{alert("Berhasil update!"),F.visit("/profile")}})}catch(n){if(console.error(n),((l=n.response)==null?void 0:l.status)===422){const J=n.response.data.errors;alert(Object.values(J).flat().join(`
`))}else alert("Terjadi kesalahan. Silakan coba lagi.")}finally{w(!1)}};return e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(f,{variant:"ghost",onClick:m,className:"text-gray-600 hover:text-emerald-600",disabled:i,children:[e.jsx(Q,{size:20,className:"mr-2"}),"Kembali ke Profil Saya"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Profil"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Edit Profil"})]})]}),e.jsxs("form",{onSubmit:G,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(N,{className:"flex h-full flex-col",children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(Y,{size:20,className:"mr-2 text-emerald-600"}),"Informasi Pengguna"]})}),e.jsxs(b,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"name",children:["Nama Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(q,{id:"name",placeholder:"Masukkan nama lengkap Anda",value:r.name,onChange:s=>d("name",s.target.value),required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"phone",children:["Nomor Telepon"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(q,{id:"phone",placeholder:"Masukkan nomor telepon Anda",value:r.phone,type:"phone",onChange:s=>d("phone",s.target.value),required:!0,disabled:i})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(N,{className:"flex h-full flex-col",children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(se,{size:20,className:"mr-2 text-emerald-600"}),"Alamat Pengguna"]})}),e.jsx(b,{className:"flex-1 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:r.province_id,onValueChange:s=>d("province_id",s),disabled:i,children:[e.jsx(S,{children:e.jsx(k,{placeholder:"Pilih provinsi"})}),e.jsx(C,{children:o.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:r.city_id,onValueChange:s=>d("city_id",s),disabled:!u.length||i,children:[e.jsx(S,{children:e.jsx(k,{placeholder:"Pilih kota"})}),e.jsx(C,{children:u.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(_,{value:r.district_id,onValueChange:s=>d("district_id",s),disabled:!A.length||i,children:[e.jsx(S,{children:e.jsx(k,{placeholder:"Pilih kecamatan"})}),e.jsx(C,{children:A.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{id:"address",placeholder:"Masukkan detail alamat Anda",rows:3,value:r.address,onChange:s=>d("address",s.target.value),required:!0,disabled:i})]})]})})]})})]}),e.jsx("div",{className:"w-full",children:e.jsxs(N,{children:[e.jsx(v,{children:e.jsxs(y,{className:"flex items-center",children:[e.jsx(ae,{size:20,className:"mr-2 text-emerald-600"}),"Foto Profil Pengguna"]})}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-emerald-400",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:s=>V(s.target.files),className:"hidden",id:"file-upload",disabled:i}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${i?"cursor-not-allowed opacity-50":""}`,children:[e.jsx(W,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, JPEG hingga 2MB"})]})]}),p.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:p.map((s,a)=>e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-100",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-full w-full rounded-lg object-cover"}):e.jsx(X,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>R(a),className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",disabled:i,children:e.jsx(Z,{size:14})}),e.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:s.name})]},a))})]})]})}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 rounded-lg border border-gray-200 bg-white p-3 shadow-sm sm:flex-row",children:[e.jsx(f,{type:"button",variant:"outline",onClick:m,className:"sm:w-auto",disabled:i,children:"Batal"}),e.jsx(f,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 sm:w-auto",size:"lg",disabled:i,children:i?"Mengirim...":"Update"})]})]})]})},he=()=>{var i;const{props:o}=H(),m=((i=o.auth)==null?void 0:i.user)??null,t=o.provinces??[];return m?e.jsx(ee,{currentPage:"profile",children:e.jsx(ie,{auth:{user:m},provinces:t,onBack:()=>F.visit("/profile")})}):null};export{he as default};
