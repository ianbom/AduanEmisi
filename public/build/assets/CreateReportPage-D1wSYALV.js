const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapPicker-DVUcSsfr.js","assets/app-D6oXFsZo.js","assets/app-B0eEGxk4.css","assets/TileLayer-DW4ypez-.js","assets/index-yxFBMRA-.js"])))=>i.map(i=>d[i]);
import{r as o,j as e,S as E,_ as T}from"./app-D6oXFsZo.js";import{B as p,I as R}from"./input-Dwu2-R7m.js";import{C as S,b as C,c as P,a as L}from"./card-9QcjhDUT.js";import{L as c}from"./label-DTNVho_7.js";import{S as h,a as u,b as x,c as g,d as l}from"./select-DkgeVxYR.js";import{T as z}from"./textarea-28rOy-yk.js";import{A as q}from"./arrow-left-mt-w7Zve.js";import{I as H,X as J}from"./Footer-FNOhNCFm.js";import{C as $}from"./camera-D4DLPlMJ.js";import{U as O,F as W}from"./upload-NRn4m1f0.js";import{M as I}from"./map-pin-C8qLAtO4.js";const X=o.lazy(()=>T(()=>import("./MapPicker-DVUcSsfr.js"),__vite__mapDeps([0,1,2,3,4]))),de=({provinces:F,onBack:w})=>{const[n,j]=o.useState(null),[K,f]=o.useState(!1),[t,v]=o.useState(!1),[r,m]=o.useState({title:"",description:"",category:"",address:"",province_id:"",city_id:"",district_id:""}),[y,b]=o.useState([]),A=()=>{if(!navigator.geolocation){alert("Browser tidak mendukung geolokasi");return}f(!0),navigator.geolocation.getCurrentPosition(a=>{const{latitude:s,longitude:i}=a.coords;j({latitude:s,longitude:i}),f(!1)},a=>{console.error("Gagal dapat lokasi:",a),alert("Tidak bisa mendapatkan lokasi. Pastikan izin lokasi aktif."),f(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},N=F.find(a=>a.id.toString()===r.province_id),k=(N==null?void 0:N.cities)??[],_=k.find(a=>a.id.toString()===r.city_id),M=(_==null?void 0:_.districts)??[],d=(a,s)=>{m(a==="province_id"?i=>({...i,province_id:s,city_id:"",district_id:""}):a==="city_id"?i=>({...i,city_id:s,district_id:""}):i=>({...i,[a]:s}))},D=a=>{if(a){const s=Array.from(a).filter(i=>i.size>10485760?(alert(`File ${i.name} terlalu besar. Maksimal 10MB.`),!1):!0);b(i=>[...i,...s])}},U=a=>{b(s=>s.filter((i,B)=>B!==a))},G=()=>{const a=[{field:"title",name:"Judul Laporan"},{field:"description",name:"Deskripsi"},{field:"category",name:"Kategori"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:s,name:i}of a)if(!r[s])return alert(`${i} wajib diisi.`),!1;return n?!0:(alert("Lokasi wajib dipilih. Silakan gunakan GPS atau pilih di peta."),!1)},V=async a=>{if(a.preventDefault(),!G())return;v(!0);const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("category",r.category),s.append("address",r.address),s.append("province_id",r.province_id),s.append("city_id",r.city_id),s.append("district_id",r.district_id),n&&(s.append("latitude",n.latitude.toString()),s.append("longitude",n.longitude.toString())),y.forEach(i=>{s.append("media[]",i)}),E.post("/reports",s,{forceFormData:!0,onStart:()=>v(!0),onFinish:()=>v(!1),onSuccess:()=>{m({title:"",description:"",category:"",address:"",province_id:"",city_id:"",district_id:""}),j(null),b([])},onError:i=>{console.error("Form errors:",i)}})};return e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[" ",e.jsxs(p,{variant:"ghost",onClick:w,className:"text-gray-600 hover:text-emerald-600",disabled:t,children:[e.jsx(q,{size:20,className:"mr-2"}),"Kembali ke Daftar Laporan"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Laporan"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Buat Laporan"})]})]}),e.jsxs("form",{onSubmit:V,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center",children:[e.jsx(H,{size:20,className:"mr-2 text-emerald-600"}),"Informasi Dasar"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"title",children:["Judul Laporan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(R,{id:"title",placeholder:"Masukkan judul laporan yang jelas dan deskriptif",value:r.title,onChange:a=>d("title",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"description",children:["Deskripsi Masalah Detail"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"description",placeholder:"Jelaskan masalah lingkungan yang Anda temukan secara detail...",rows:5,value:r.description,onChange:a=>d("description",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",children:["Kategori Isu"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:r.category,onValueChange:a=>d("category",a),disabled:t,children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Pilih kategori masalah"})}),e.jsxs(g,{children:[e.jsx(l,{value:"sampah-plastik",children:"Sampah Plastik"}),e.jsx(l,{value:"pencemaran-air",children:"Pencemaran Air"}),e.jsx(l,{value:"pencemaran-udara",children:"Pencemaran Udara"}),e.jsx(l,{value:"pencemaran-tanah",children:"Pencemaran Tanah"}),e.jsx(l,{value:"limbah-industri",children:"Limbah Industri"}),e.jsx(l,{value:"emisi-gas-rumah-kaca",children:"Emisi Gas Rumah Kaca"}),e.jsx(l,{value:"penggundulan-kebakaran-hutan",children:"Penggundulan / Kebakaran Hutan"}),e.jsx(l,{value:"naiknya-permukaan-air-laut",children:"Naiknya Permukaan Air Laut"}),e.jsx(l,{value:"limbah-pertanian-peternakan",children:"Limbah Pertanian / Peternakan"}),e.jsx(l,{value:"lainnya",children:"Lainnya"})]})]})]})]})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center",children:[e.jsx($,{size:20,className:"mr-2 text-emerald-600"}),"Unggah Foto/Video"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-emerald-400",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:a=>D(a.target.files),className:"hidden",id:"file-upload",disabled:t}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${t?"cursor-not-allowed opacity-50":""}`,children:[e.jsx(O,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF, MP4 hingga 10MB"})]})]}),y.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:y.map((a,s)=>e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-100",children:a.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(a),alt:a.name,className:"h-full w-full rounded-lg object-cover"}):e.jsx(W,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>U(s),className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",disabled:t,children:e.jsx(J,{size:14})}),e.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:a.name})]},s))})]})]})]}),e.jsx("div",{className:"col-span-2 space-y-6",children:e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center",children:[e.jsx(I,{size:20,className:"mr-2 text-emerald-600"}),"Lokasi Masalah"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsx("div",{className:"h-64 overflow-hidden rounded-lg border-2 border-dashed border-gray-300 bg-gray-100",children:e.jsx(X,{onChange:a=>j(a),location:n,disabled:t})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Lokasi terpilih:"," ",n?e.jsxs("span",{className:"font-medium text-emerald-600",children:[n.latitude,","," ",n.longitude]}):e.jsx("span",{className:"text-red-500",children:"Belum dipilih"})]})}),e.jsxs(p,{type:"button",variant:"outline",className:"w-full border-emerald-200 text-emerald-600 hover:bg-emerald-50",onClick:A,disabled:K||t,children:[e.jsx(I,{size:16,className:"mr-2"}),K?"Mengambil lokasi...":"Gunakan Lokasi Saya Sekarang (GPS)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"address",placeholder:"Masukkan alamat lengkap lokasi masalah",rows:3,value:r.address,onChange:a=>d("address",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:r.province_id,onValueChange:a=>d("province_id",a),disabled:t,children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Pilih provinsi"})}),e.jsx(g,{children:F.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:r.city_id,onValueChange:a=>d("city_id",a),disabled:!k.length||t,children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Pilih kota"})}),e.jsx(g,{children:k.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(h,{value:r.district_id,onValueChange:a=>d("district_id",a),disabled:!M.length||t,children:[e.jsx(u,{children:e.jsx(x,{placeholder:"Pilih kecamatan"})}),e.jsx(g,{children:M.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]})]})]})]})]})})]}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 rounded-lg border border-gray-200 bg-white p-3 shadow-sm sm:flex-row",children:[e.jsx(p,{type:"button",variant:"outline",onClick:w,className:"sm:w-auto",disabled:t,children:"Batal"}),e.jsx(p,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 sm:w-auto",size:"lg",disabled:t,children:t?"Mengirim...":"Kirim Laporan"})]})]})]})};export{de as C};
