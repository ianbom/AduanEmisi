import{r as h,j as e}from"./app-D6oXFsZo.js";import{B as u}from"./Footer-FNOhNCFm.js";import{B as y,I as M}from"./input-Dwu2-R7m.js";import{C as z,a as T}from"./card-9QcjhDUT.js";import{S as b,a as N,b as w,c as k,d as c}from"./select-DkgeVxYR.js";import{g as E}from"./categoryReportLabel-Bo3G_xyd.js";import{g as L,a as R}from"./reportStatusLabel-CeJ63OXr.js";import{c as B,l as I,a as _,M as U,T as A,b as V,L as D}from"./TileLayer-DW4ypez-.js";import{c as S}from"./createLucideIcon-DCNWzv65.js";import{S as W}from"./search-IRx-XrSX.js";import{R as K}from"./refresh-ccw-7670q9GI.js";import{M as O}from"./map-pin-C8qLAtO4.js";import{C as $}from"./calendar-N5z---R7.js";import{E as H}from"./eye-ByFKtksz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=S("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=S("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Z=B(function(x,r){const o=new I.Popup(x,r.overlayContainer);return _(o,r)},function(x,r,{position:o},p){h.useEffect(function(){const{instance:n}=x;function f(s){s.popup===n&&(n.update(),p(!0))}function v(s){s.popup===n&&p(!1)}return r.map.on({popupopen:f,popupclose:v}),r.overlayContainer==null?(o!=null&&n.setLatLng(o),n.openOn(r.map)):r.overlayContainer.bindPopup(n),function(){var j;r.map.off({popupopen:f,popupclose:v}),(j=r.overlayContainer)==null||j.unbindPopup(),r.map.removeLayer(n)}},[x,r,p,o])});delete D.Icon.Default.prototype._getIconUrl;D.Icon.Default.mergeOptions({iconUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon.png",iconRetinaUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-icon-2x.png",shadowUrl:"https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png"});const me=({reports:g,provinces:x,onViewReport:r})=>{const[o,p]=h.useState(!1),[i,n]=h.useState(""),[f,v]=h.useState(g),[s,j]=h.useState({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),m=(a,t)=>{j(l=>({...l,[a]:t}))},P=()=>{j({category:"semua",status:"semua",province:"semua",startDate:"",endDate:""}),n("")};h.useEffect(()=>{let a=[...g];i.trim()&&(a=a.filter(t=>{var l,d;return t.title.toLowerCase().includes(i.toLowerCase())||((l=t.description)==null?void 0:l.toLowerCase().includes(i.toLowerCase()))||((d=t.address)==null?void 0:d.toLowerCase().includes(i.toLowerCase()))})),s.category!=="semua"&&(a=a.filter(t=>t.category.toLowerCase()===s.category.toLowerCase())),s.status!=="semua"&&(a=a.filter(t=>t.status.toLowerCase()===s.status.toLowerCase())),s.province!=="semua"&&(a=a.filter(t=>{var l;return(l=t.province)==null?void 0:l.name.toLowerCase().includes(s.province.toLowerCase())})),s.startDate&&(a=a.filter(t=>{const l=new Date(t.created_at),d=new Date(s.startDate);return l>=d})),s.endDate&&(a=a.filter(t=>{const l=new Date(t.created_at),d=new Date(s.endDate);return d.setHours(23,59,59,999),l<=d})),v(a)},[g,i,s]);const F=[{label:"Sampah Plastik",value:"sampah-plastik"},{label:"Pencemaran Air",value:"pencemaran-air"},{label:"Pencemaran Udara",value:"pencemaran-udara"},{label:"Pencemaran Tanah",value:"pencemaran-tanah"},{label:"Limbah Industri",value:"limbah-industri"},{label:"Emisi Gas Rumah Kaca",value:"emisi-gas-rumah-kaca"},{label:"Penggundulan / Kebakaran Hutan",value:"penggundulan-kebakaran-hutan"},{label:"Naiknya Permukaan Air Laut",value:"naiknya-permukaan-air-laut"},{label:"Limbah Pertanian / Peternakan",value:"limbah-pertanian-peternakan"},{label:"Lainnya",value:"lainnya"}],C=i.trim()||s.category!=="semua"||s.status!=="semua"||s.province!=="semua"||s.startDate||s.endDate;return e.jsxs("div",{className:"flex h-screen flex-col lg:flex-row",children:[e.jsx("div",{className:`bg-white shadow-lg transition-all duration-300 ${o?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden lg:relative lg:max-h-full lg:w-80 lg:border-r lg:border-gray-200 lg:opacity-100`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h2",{className:"flex items-center text-xl font-semibold text-gray-900",children:[e.jsx(Q,{size:20,className:"mr-2 text-emerald-600"}),"Filter Peta Laporan",C&&e.jsx("span",{className:"ml-2 inline-block rounded-full bg-emerald-100 px-2 py-1 text-xs text-emerald-600",children:"Aktif"})]}),e.jsx(y,{variant:"ghost",size:"sm",className:"lg:hidden",onClick:()=>p(!1),children:"×"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(M,{placeholder:"Cari laporan...",className:"pl-10",value:i,onChange:a=>n(a.target.value)})]})}),(s.category!=="semua"||s.status!=="semua"||s.province!=="semua"||s.startDate||s.endDate||i)&&e.jsxs("div",{className:"mb-4 flex flex-wrap gap-2",children:[e.jsx("span",{className:"mb-1 text-xs font-medium text-gray-700",children:"Filter aktif:"}),i&&e.jsxs(u,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:['"',i,'"',e.jsx("button",{onClick:()=>n(""),className:"ml-1 text-xs",children:"×"})]}),s.category!=="semua"&&e.jsxs(u,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[s.category,e.jsx("button",{onClick:()=>m("category","semua"),className:"ml-1 text-xs",children:"×"})]}),s.status!=="semua"&&e.jsxs(u,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[L(s.status),e.jsx("button",{onClick:()=>m("status","semua"),className:"ml-1 text-xs",children:"×"})]}),s.province!=="semua"&&e.jsxs(u,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[s.province,e.jsx("button",{onClick:()=>m("province","semua"),className:"ml-1 text-xs",children:"×"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kategori Laporan"}),e.jsxs(b,{value:s.category,onValueChange:a=>m("category",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua kategori"})}),e.jsxs(k,{children:[e.jsx(c,{value:"semua",children:"Semua Kategori"}),F.map(a=>e.jsx(c,{value:a.value,children:a.label},a.value))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Status Laporan"}),e.jsxs(b,{value:s.status,onValueChange:a=>m("status",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua status"})}),e.jsxs(k,{children:[e.jsx(c,{value:"semua",children:"Semua Status"}),e.jsx(c,{value:"pending",children:"Menunggu"}),e.jsx(c,{value:"verified",children:"Terverifikasi"}),e.jsx(c,{value:"on-progress",children:"Sedang Diproses"}),e.jsx(c,{value:"rejected",children:"Ditolak"}),e.jsx(c,{value:"completed",children:"Selesai"}),e.jsx(c,{value:"under-authority",children:"Ditangani Pihak Berwenang"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Provinsi"}),e.jsxs(b,{value:s.province,onValueChange:a=>m("province",a),children:[e.jsx(N,{children:e.jsx(w,{placeholder:"Semua Provinsi"})}),e.jsxs(k,{children:[e.jsx(c,{value:"semua",children:"Semua Provinsi"}),x.map(a=>e.jsx(c,{value:a.name,children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tanggal Mulai"}),e.jsx("input",{type:"date",className:"w-full rounded-md border border-gray-200 px-2 py-2",value:s.startDate,onChange:a=>m("startDate",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tanggal Selesai"}),e.jsx("input",{type:"date",className:"w-full rounded-md border border-gray-200 px-2 py-2",value:s.endDate,onChange:a=>m("endDate",a.target.value),min:s.startDate})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(y,{variant:"outline",className:"flex w-full items-center justify-center gap-2",onClick:P,disabled:!C,children:[e.jsx(K,{className:"h-4 w-4"}),"Reset Filter"]})})]})]})}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"p-4 lg:hidden",children:e.jsx(y,{onClick:()=>p(!o),className:"w-full bg-emerald-600 text-white",children:o?"Tutup Filter":"Tampilkan Filter"})}),e.jsxs(U,{center:[-2.5489,118.0149],zoom:5,scrollWheelZoom:!0,className:"z-10 h-full w-full",children:[e.jsx(A,{attribution:'© <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),f.map(a=>{var t,l;return e.jsx(V,{position:[a.latitude,a.longitude],children:e.jsx(Z,{className:"custom-popup",minWidth:280,maxWidth:320,closeButton:!0,autoPan:!0,children:e.jsxs("div",{className:"relative overflow-hidden rounded-lg bg-white shadow-lg",children:[e.jsxs("div",{className:"relative h-32 bg-gradient-to-r from-emerald-500 to-teal-600",children:[(t=a.media)!=null&&t[0]?(l=a.media[0].media_type)!=null&&l.startsWith("video")?e.jsxs("div",{className:"relative h-full w-full bg-black",children:[e.jsx("video",{className:"h-full w-full object-cover opacity-50",src:`/storage/${a.media[0].media_url}`,muted:!0,preload:"metadata"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"rounded-full bg-white/80 p-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-black",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-5.197-3.03A1 1 0 008 9.03v5.94a1 1 0 001.555.832l5.197-3.03a1 1 0 000-1.664z"})})})})]}):e.jsx("img",{src:`/storage/${a.media[0].media_url}`,alt:a.title,className:"h-full w-full object-cover"}):e.jsx("div",{className:"flex h-full items-center justify-center bg-gray-800",children:e.jsx("svg",{className:"h-8 w-8 text-white/80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),e.jsx("div",{className:"absolute right-2 top-2",children:e.jsx(u,{className:`${R(a.status)} text-xs font-medium shadow-sm`,children:L(a.status)})}),a.hasMission&&e.jsx("div",{className:"absolute left-2 top-2",children:e.jsx(u,{className:"bg-blue-500 text-xs font-medium text-white shadow-sm",children:"Ada Misi"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-2",children:e.jsx(u,{className:"border-gray-200 bg-gray-50 text-xs font-medium text-gray-700",children:E(a.category)})}),e.jsx("h3",{className:"mb-3 line-clamp-2 text-base font-semibold leading-tight text-gray-900",children:a.title}),e.jsxs("div",{className:"mb-3 flex items-start text-sm text-gray-600",children:[e.jsx(O,{size:14,className:"mr-2 mt-0.5 flex-shrink-0 text-gray-400"}),e.jsx("span",{className:"line-clamp-2",children:a.address})]}),e.jsxs("div",{className:"mb-4 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{size:12,className:"mr-1"}),e.jsx("span",{children:a.created_at})]}),e.jsxs("div",{className:"flex items-center text-emerald-600",children:[e.jsx(G,{size:12,className:"mr-1"}),e.jsx("span",{className:"font-medium",children:a.upvotes_count||0})]})]}),e.jsxs(y,{size:"sm",onClick:()=>r(a.id),className:"w-full bg-emerald-600 text-white transition-colors duration-200 hover:bg-emerald-700",children:[e.jsx(H,{size:14,className:"mr-2"}),"Lihat Detail"]})]})]})})},a.id)})]}),e.jsx("div",{className:"absolute bottom-4 right-4 z-20",children:e.jsx(z,{className:"bg-white/90 shadow-lg backdrop-blur-sm",children:e.jsxs(T,{className:"p-3 text-center",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[f.length," Laporan Ditemukan"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Klik marker untuk lihat detail"})]})})})]})]})};export{me as M};
