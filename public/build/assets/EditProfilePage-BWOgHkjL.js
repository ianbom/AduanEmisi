import{r as f,j as e,a as W,S as R,J as X}from"./app-ATs5ISiJ.js";import{B as v,C as y,b as N,d as b,a as _}from"./card-BBmrTWXU.js";import{I as V}from"./input-sdXClQRc.js";import{L as c}from"./label-BDwX46Ze.js";import{S as k,a as S,b as C,c as P,d as w}from"./select-CCZS_z3t.js";import{T as Q,U as Y,F as Z}from"./textarea-DbymCI5F.js";import{A as ee}from"./arrow-left-Bs2ABTHx.js";import{I as se,X as ae,C as ie}from"./CitizenLayout-CMNJ2BA9.js";import{M as re}from"./map-pin-LoYpawZ8.js";import{C as te}from"./camera-wZGpEHCr.js";import"./index-Cm3cBoio.js";import"./index-CIsbbVlV.js";import"./file-text-DNWXWrmL.js";const le=({provinces:o,onBack:m,auth:l})=>{var A,L,T,z,K,E,I,U,q;const[r,F]=f.useState(!1),[t,p]=f.useState({name:((A=l.user)==null?void 0:A.name)||"",phone:((L=l.user)==null?void 0:L.phone)||"",address:((T=l.user)==null?void 0:T.address)||"",province_id:((K=(z=l.user)==null?void 0:z.province_id)==null?void 0:K.toString())||"",city_id:((I=(E=l.user)==null?void 0:E.city_id)==null?void 0:I.toString())||"",district_id:((q=(U=l.user)==null?void 0:U.district_id)==null?void 0:q.toString())||""}),[x,h]=f.useState([]),u=o.find(s=>s.id.toString()===t.province_id),g=(u==null?void 0:u.cities)??[],j=g.find(s=>s.id.toString()===t.city_id),M=(j==null?void 0:j.districts)??[],n=(s,i)=>{p(s==="province_id"?a=>({...a,province_id:i,city_id:"",district_id:""}):s==="city_id"?a=>({...a,city_id:i,district_id:""}):a=>({...a,[s]:i}))},D=s=>{if(s){const i=Array.from(s).filter(a=>a.size>10485760?(alert(`File ${a.name} terlalu besar. Maksimal 10MB.`),!1):!0);h(a=>[...a,...i])}},G=s=>{h(i=>i.filter((a,d)=>d!==s))},J=()=>{const s=[{field:"name",name:"Nama Lengkap"},{field:"phone",name:"Nomor Telepon"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:i,name:a}of s)if(!t[i])return alert(`${a} wajib diisi.`),!1;return!0},$=async s=>{if(s.preventDefault(),!J())return;F(!0);const i=new FormData;i.append("name",t.name),i.append("phone",t.phone),i.append("address",t.address),i.append("province_id",t.province_id),i.append("city_id",t.city_id),i.append("district_id",t.district_id),x.forEach(a=>{i.append("media[]",a)});try{const a=await W.post("/reports",i,{headers:{"Content-Type":"multipart/form-data"}});console.log("Report submitted:",a.data),alert("Laporan berhasil dikirim!"),p({province_id:String(l.user.province_id??""),city_id:String(l.user.city_id??""),district_id:String(l.user.district_id??""),address:l.user.address??"",phone:l.user.phone??"",name:l.user.name??""}),h([]),R.visit("/profile")}catch(a){if(console.error("Error submitting report:",a),a.response){const{status:d,data:B}=a.response;if(d===422){const H=B.errors||{},O=Object.values(H).flat();alert(`Validasi gagal:
`+O.join(`
`))}else alert(d===401?"Anda belum login. Silakan login terlebih dahulu.":d===413?"File yang diunggah terlalu besar. Maksimal 10MB per file.":d===500?"Terjadi kesalahan pada server. Silakan coba lagi nanti.":"Terjadi kesalahan: "+(B.message||"Unknown error"))}else a.request?alert("Tidak dapat terhubung ke server. Periksa koneksi internet Anda."):alert("Terjadi kesalahan yang tidak terduga. Silakan coba lagi.")}finally{F(!1)}};return e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(v,{variant:"ghost",onClick:m,className:"text-gray-600 hover:text-emerald-600",disabled:r,children:[e.jsx(ee,{size:20,className:"mr-2"}),"Kembali ke Profil Saya"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Profil"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Edit Profil"})]})]}),e.jsxs("form",{onSubmit:$,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(y,{className:"flex h-full flex-col",children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(se,{size:20,className:"mr-2 text-emerald-600"}),"Informasi Pengguna"]})}),e.jsxs(_,{className:"flex-1 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"name",children:["Nama Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"name",placeholder:"Masukkan nama lengkap Anda",value:t.name,onChange:s=>n("name",s.target.value),required:!0,disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"phone",children:["Nomor Telepon"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(V,{id:"phone",placeholder:"Masukkan nomor telepon Anda",value:t.phone,type:"phone",onChange:s=>n("phone",s.target.value),required:!0,disabled:r})]})]})]})}),e.jsx("div",{className:"flex flex-col space-y-6",children:e.jsxs(y,{className:"flex h-full flex-col",children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(re,{size:20,className:"mr-2 text-emerald-600"}),"Alamat Pengguna"]})}),e.jsx(_,{className:"flex-1 space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(k,{value:t.province_id,onValueChange:s=>n("province_id",s),disabled:r,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Pilih provinsi"})}),e.jsx(P,{children:o.map(s=>e.jsx(w,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(k,{value:t.city_id,onValueChange:s=>n("city_id",s),disabled:!g.length||r,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Pilih kota"})}),e.jsx(P,{children:g.map(s=>e.jsx(w,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(k,{value:t.district_id,onValueChange:s=>n("district_id",s),disabled:!M.length||r,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Pilih kecamatan"})}),e.jsx(P,{children:M.map(s=>e.jsx(w,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Q,{id:"address",placeholder:"Masukkan detail alamat Anda",rows:3,value:t.address,onChange:s=>n("address",s.target.value),required:!0,disabled:r})]})]})})]})})]}),e.jsx("div",{className:"w-full",children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsxs(b,{className:"flex items-center",children:[e.jsx(te,{size:20,className:"mr-2 text-emerald-600"}),"Foto Profil Pengguna"]})}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-emerald-400",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:s=>D(s.target.files),className:"hidden",id:"file-upload",disabled:r}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${r?"cursor-not-allowed opacity-50":""}`,children:[e.jsx(Y,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, JPEG hingga 2MB"})]})]}),x.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:x.map((s,i)=>e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-100",children:s.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"h-full w-full rounded-lg object-cover"}):e.jsx(Z,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>G(i),className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",disabled:r,children:e.jsx(ae,{size:14})}),e.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:s.name})]},i))})]})]})}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 rounded-lg border border-gray-200 bg-white p-3 shadow-sm sm:flex-row",children:[e.jsx(v,{type:"button",variant:"outline",onClick:m,className:"sm:w-auto",disabled:r,children:"Batal"}),e.jsx(v,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 sm:w-auto",size:"lg",disabled:r,children:r?"Mengirim...":"Kirim Laporan"})]})]})]})},ye=()=>{var r;const{props:o}=X(),m=((r=o.auth)==null?void 0:r.user)??null,l=o.provinces??[];return e.jsx(ie,{currentPage:"profile",children:e.jsx(le,{auth:{user:m},provinces:l,onBack:()=>R.visit("/profile")})})};export{ye as default};
