const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MapPicker-CYE8ylvj.js","assets/app-CEf6-TVv.js","assets/app-Bfn5tWhV.css","assets/TileLayer-D56C_8QM.js","assets/index-T59oawn7.js"])))=>i.map(i=>d[i]);
import{r as m,j as e,a as R,S as H,_ as J}from"./app-CEf6-TVv.js";import{B as h,C as S,b as C,d as w,a as L,I as O}from"./index-T59oawn7.js";import{L as c}from"./label-r7WXdrwQ.js";import{S as u,a as x,b as g,c as j,d as l}from"./select-D_0_1Ftm.js";import{T as I,U as $,F as W}from"./textarea-CYm7tM4B.js";import{A as X}from"./arrow-left-msm6bzUj.js";import{I as Q,X as Y}from"./CitizenLayout-BJCqtu_4.js";import{C as Z}from"./camera-DnnFKy1W.js";import{M as T}from"./map-pin-CvMsSeln.js";const ee=m.lazy(()=>J(()=>import("./MapPicker-CYE8ylvj.js"),__vite__mapDeps([0,1,2,3,4]))),oe=({provinces:P,onBack:F})=>{const[n,f]=m.useState(null),[M,y]=m.useState(!1),[t,z]=m.useState(!1),[r,p]=m.useState({title:"",description:"",category:"",address:"",province_id:"",city_id:"",district_id:""}),[v,b]=m.useState([]),D=()=>{if(!navigator.geolocation){alert("Browser tidak mendukung geolokasi");return}y(!0),navigator.geolocation.getCurrentPosition(a=>{const{latitude:s,longitude:i}=a.coords;f({latitude:s,longitude:i}),y(!1)},a=>{console.error("Gagal dapat lokasi:",a),alert("Tidak bisa mendapatkan lokasi. Pastikan izin lokasi aktif."),y(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},k=P.find(a=>a.id.toString()===r.province_id),N=(k==null?void 0:k.cities)??[],_=N.find(a=>a.id.toString()===r.city_id),A=(_==null?void 0:_.districts)??[],d=(a,s)=>{p(a==="province_id"?i=>({...i,province_id:s,city_id:"",district_id:""}):a==="city_id"?i=>({...i,city_id:s,district_id:""}):i=>({...i,[a]:s}))},U=a=>{if(a){const s=Array.from(a).filter(i=>i.size>10485760?(alert(`File ${i.name} terlalu besar. Maksimal 10MB.`),!1):!0);b(i=>[...i,...s])}},V=a=>{b(s=>s.filter((i,o)=>o!==a))},B=()=>{const a=[{field:"title",name:"Judul Laporan"},{field:"description",name:"Deskripsi"},{field:"category",name:"Kategori"},{field:"address",name:"Alamat"},{field:"province_id",name:"Provinsi"},{field:"city_id",name:"Kota/Kabupaten"},{field:"district_id",name:"Kecamatan"}];for(const{field:s,name:i}of a)if(!r[s])return alert(`${i} wajib diisi.`),!1;return n?!0:(alert("Lokasi wajib dipilih. Silakan gunakan GPS atau pilih di peta."),!1)},G=async a=>{if(a.preventDefault(),!B())return;z(!0);const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("category",r.category),s.append("address",r.address),s.append("province_id",r.province_id),s.append("city_id",r.city_id),s.append("district_id",r.district_id),n&&(s.append("latitude",n.latitude.toString()),s.append("longitude",n.longitude.toString())),v.forEach(i=>{s.append("media[]",i)});try{const i=await R.post("/reports",s,{headers:{"Content-Type":"multipart/form-data"}});console.log("Report submitted:",i.data),alert("Laporan berhasil dikirim!"),p({title:"",description:"",category:"",address:"",province_id:"",city_id:"",district_id:""}),f(null),b([]),H.visit("/report")}catch(i){if(console.error("Error submitting report:",i),i.response){const{status:o,data:K}=i.response;if(o===422){const q=K.errors||{},E=Object.values(q).flat();alert(`Validasi gagal:
`+E.join(`
`))}else alert(o===401?"Anda belum login. Silakan login terlebih dahulu.":o===413?"File yang diunggah terlalu besar. Maksimal 10MB per file.":o===500?"Terjadi kesalahan pada server. Silakan coba lagi nanti.":"Terjadi kesalahan: "+(K.message||"Unknown error"))}else i.request?alert("Tidak dapat terhubung ke server. Periksa koneksi internet Anda."):alert("Terjadi kesalahan yang tidak terduga. Silakan coba lagi.")}finally{z(!1)}};return e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs(h,{variant:"ghost",onClick:F,className:"text-gray-600 hover:text-emerald-600",disabled:t,children:[e.jsx(X,{size:20,className:"mr-2"}),"Kembali ke Daftar Laporan"]}),e.jsxs("div",{className:"space-x-1 text-sm text-gray-500",children:[e.jsx("span",{className:"cursor-pointer hover:underline",children:"Home"}),e.jsx("span",{className:"cursor-pointer hover:underline",children:"/ Laporan"})," ","/",e.jsx("span",{className:"font-medium text-gray-700",children:"Buat Laporan"})]})]}),e.jsxs("form",{onSubmit:G,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-4",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(Q,{size:20,className:"mr-2 text-emerald-600"}),"Informasi Dasar"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"title",children:["Judul Laporan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(O,{id:"title",placeholder:"Masukkan judul laporan yang jelas dan deskriptif",value:r.title,onChange:a=>d("title",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"description",children:["Deskripsi Masalah Detail"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(I,{id:"description",placeholder:"Jelaskan masalah lingkungan yang Anda temukan secara detail...",rows:5,value:r.description,onChange:a=>d("description",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"category",children:["Kategori Isu"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(u,{value:r.category,onValueChange:a=>d("category",a),disabled:t,children:[e.jsx(x,{children:e.jsx(g,{placeholder:"Pilih kategori masalah"})}),e.jsxs(j,{children:[e.jsx(l,{value:"pencemaran-air",children:"Pencemaran Air"}),e.jsx(l,{value:"pencemaran-laut",children:"Pencemaran Laut"}),e.jsx(l,{value:"kerusakan-hutan",children:"Kerusakan Hutan"}),e.jsx(l,{value:"sampah-plastik",children:"Sampah Plastik"}),e.jsx(l,{value:"pencemaran-udara",children:"Pencemaran Udara"}),e.jsx(l,{value:"lainnya",children:"Lainnya"})]})]})]})]})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(Z,{size:20,className:"mr-2 text-emerald-600"}),"Unggah Foto/Video"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-8 text-center transition-colors hover:border-emerald-400",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:a=>U(a.target.files),className:"hidden",id:"file-upload",disabled:t}),e.jsxs("label",{htmlFor:"file-upload",className:`cursor-pointer ${t?"cursor-not-allowed opacity-50":""}`,children:[e.jsx($,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"mb-2 text-lg font-medium text-gray-700",children:"Klik untuk mengunggah atau seret file ke sini"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF, MP4 hingga 10MB"})]})]}),v.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:v.map((a,s)=>e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-100",children:a.type.startsWith("image/")?e.jsx("img",{src:URL.createObjectURL(a),alt:a.name,className:"h-full w-full rounded-lg object-cover"}):e.jsx(W,{size:24,className:"text-gray-400"})}),e.jsx("button",{type:"button",onClick:()=>V(s),className:"absolute -right-2 -top-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",disabled:t,children:e.jsx(Y,{size:14})}),e.jsx("p",{className:"mt-1 truncate text-xs text-gray-500",children:a.name})]},s))})]})]})]}),e.jsx("div",{className:"col-span-2 space-y-6",children:e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center",children:[e.jsx(T,{size:20,className:"mr-2 text-emerald-600"}),"Lokasi Masalah"]})}),e.jsxs(L,{className:"space-y-6",children:[e.jsx("div",{className:"h-64 overflow-hidden rounded-lg border-2 border-dashed border-gray-300 bg-gray-100",children:e.jsx(ee,{onChange:a=>f(a),location:n,disabled:t})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Lokasi terpilih:"," ",n?e.jsxs("span",{className:"font-medium text-emerald-600",children:[n.latitude,","," ",n.longitude]}):e.jsx("span",{className:"text-red-500",children:"Belum dipilih"})]})}),e.jsxs(h,{type:"button",variant:"outline",className:"w-full border-emerald-200 text-emerald-600 hover:bg-emerald-50",onClick:D,disabled:M||t,children:[e.jsx(T,{size:16,className:"mr-2"}),M?"Mengambil lokasi...":"Gunakan Lokasi Saya Sekarang (GPS)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"address",children:["Alamat Lengkap"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(I,{id:"address",placeholder:"Masukkan alamat lengkap lokasi masalah",rows:3,value:r.address,onChange:a=>d("address",a.target.value),required:!0,disabled:t})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Provinsi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(u,{value:r.province_id,onValueChange:a=>d("province_id",a),disabled:t,children:[e.jsx(x,{children:e.jsx(g,{placeholder:"Pilih provinsi"})}),e.jsx(j,{children:P.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kota/Kabupaten"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(u,{value:r.city_id,onValueChange:a=>d("city_id",a),disabled:!N.length||t,children:[e.jsx(x,{children:e.jsx(g,{placeholder:"Pilih kota"})}),e.jsx(j,{children:N.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{children:["Kecamatan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(u,{value:r.district_id,onValueChange:a=>d("district_id",a),disabled:!A.length||t,children:[e.jsx(x,{children:e.jsx(g,{placeholder:"Pilih kecamatan"})}),e.jsx(j,{children:A.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]})]})]})]})]})})]}),e.jsxs("div",{className:"flex flex-col justify-start gap-4 rounded-lg border border-gray-200 bg-white p-3 shadow-sm sm:flex-row",children:[e.jsx(h,{type:"button",variant:"outline",onClick:F,className:"sm:w-auto",disabled:t,children:"Batal"}),e.jsx(h,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700 sm:w-auto",size:"lg",disabled:t,children:t?"Mengirim...":"Kirim Laporan"})]})]})]})};export{oe as C};
